 # 给第三方开发者的说明

## 第三方使用时的注意事项

### VOICEVOX的基本操作

VOICEVOX应用程序大体上由两个部分组成：用户可见的GUI（前端部分）和负责语音合成的引擎（后端部分）。通常，当启动VOICEVOX的GUI时，背后会依次启动引擎（根据注册的多引擎数量）。第三方要使用语音合成功能，需要访问后台启动的引擎。

### 如何访问VOICEVOX

要使用VOICEVOX的引擎，必须通过API进行访问。除非有特殊原因，请尽量避免通过API之外的方式进行访问（例如，直接修改文件等操作可能导致不稳定，或者引发VOICEVOX未经过测试的行为）。

VOICEVOX已提供了进行语音合成所需的API，但如果有些功能或操作API无法实现，建议在VOICEVOX的Issue页面上提出API实现的建议。

### API的访问方式

可以通过HTTP访问API。

- VOICEVOX引擎默认使用的端口号是内部设定的（例如：50021/tcp）。
- 如果其他应用程序使用相同的端口号，将会发生冲突，这时会打开另一个端口。
- 要确定最终打开的端口号，请参考信息文件。
- 动态端口号的变化功能是在VOICEVOX v0.16及之后的版本中引入的。

### 运行时信息文件（即信息文件）

为了让第三方开发者获取所需的信息，系统会生成一个“信息文件”。第三方开发者应首先参考此文件以确定访问端点。

另外，如果VOICEVOX内的引擎重新启动，通信端口号可能会发生变化。如果在使用API时突然发生通信失败，请检查信息文件是否已更新。

（请注意：在旧版VOICEVOX中没有实现此文件生成功能，某些版本可能不会动态决定端口号。为了保持向下兼容，请假设此文件可能不存在。）

## 关于信息文件

### 文件位置

文件存放在以下位置：

| 操作系统        | 文件路径                                                                |
|-----------------|--------------------------------------------------------------------------|
| Windows         | C:\Users\（用户名）\AppData\Roaming\voicevox\runtime-info.json           |
| MacOS           | /Users/（用户名）/Library/Application Support/voicevox/runtime-info.json |

请注意，在Windows系统中，文件的存放位置可能会根据个人配置有所不同。要准确定位该文件，建议使用环境变量`APPDATA`来确定Roaming文件夹的位置。

### 文件内容和含义

该文件是JSON格式的，内容结构如下所示：

```JSONC
{
  //[string] VOICEVOX的版本号
  "appVersion": "xxx.yyy.zzz",

  //[number] 文件结构版本（每次规格变更时递增）
  "formatVersion": 1,

  // 引擎数据（每个运行的引擎都有一个条目）
  "engineInfos": [
    {
      //[string] 引擎名称
      "name": "engine1",
      
      //[string] API端点
      "url": "http://127.0.0.1:50021",

      //[UUID] 引擎标识的UUID
      "uuid": "00000000-0000-0000-0000-000000000001",
    },
    {
      "name": "engine2",
      "url": "http://127.0.0.1:50121",
      "uuid": "00000000-0000-0000-0000-000000000002",
    },
  ]
}
```

### 文件生成时机

- 当引擎启动（或重新启动）时，文件会生成或更新。
- 如果文件由于某些原因无法写入（例如在更新时，文件被其他工具打开），则不会更新。
- 此文件的生成时机是基于文件版本1的实现，开发过程中可能会发生变动。

